<header class="header">
  <div class="header-container">
    <div class="logo-section">
      <a routerLink="/" class="logo">
        <img src="/logo.png" [alt]="appName + ' Logo'" class="logo-icon">
      </a>
    </div>

    <nav class="nav-desktop">
      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">
        Home
      </a>
      <a routerLink="/blog" routerLinkActive="active" class="nav-link">
        Blog
      </a>
      @if (isLoggedIn) {
        <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"  class="nav-link">
          Dashboard
        </a>
        <button (click)="logout()" class="nav-link logout-btn">
          Logout
        </button>
      } @else {
        <a routerLink="/auth/login" routerLinkActive="active" class="nav-link">
          Login
        </a>
        <a routerLink="/auth/register" routerLinkActive="active" class="nav-link btn-primary">
          Get Started
        </a>
      }
    </nav>

    @if (isLoggedIn) {
      <div class="notifications-container">
        <button 
          class="notification-bell" 
          (click)="toggleNotifications()" 
          [class.has-unread]="hasUnreadNotifications()"
          aria-label="Notifications">
          <mat-icon class="bell-icon">notifications</mat-icon>
          @if (hasUnreadNotifications()) {
            <span class="notification-badge">{{ unreadCount() }}</span>
          }
        </button>

        @if (isNotificationsOpen) {
          <div class="notifications-dropdown">
            <div class="notifications-header">
              <h3>Notifications</h3>
              @if (hasUnreadNotifications()) {
                <button class="mark-all-read" (click)="markAllAsRead($event)">
                  Mark all as read
                </button>
              }
            </div>

            <div class="notifications-list">
              @if (notifications().length === 0) {
                <div class="no-notifications">
                  <p>No notifications</p>
                </div>
              } @else {
                @for (notification of notifications(); track notification.id) {
                  <div 
                    class="notification-item" 
                    [class.unread]="!notification.read_at"
                    (click)="navigateToTodo(notification)">
                    <div class="notification-icon">
                      <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
                    </div>
                    <div class="notification-content">
                      <p class="notification-message">{{ notification.data.message }}</p>
                      <span class="notification-time">{{ getRelativeTime(notification.created_at) }}</span>
                    </div>
                    <div class="notification-actions">
                      @if (!notification.read_at) {
                        <button 
                          class="mark-read-btn"
                          (click)="markAsRead(notification, $event)"
                          title="Mark as read">
                          <mat-icon>check</mat-icon>
                        </button>
                      }
                      <button 
                        class="delete-btn"
                        (click)="deleteNotification(notification.id, $event)"
                        title="Delete">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                  </div>
                }
              }
            </div>
          </div>
        }
      </div>
    }

    <button class="menu-toggle" (click)="toggleMenu()" [attr.aria-expanded]="isMenuOpen" aria-label="Toggle menu">
      <span class="hamburger" [class.open]="isMenuOpen"></span>
    </button>
  </div>

  @if (isMenuOpen) {
    <nav class="nav-mobile">
      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" 
         class="nav-link-mobile" (click)="closeMenu()">
        Home
      </a>
      <a routerLink="/blog" routerLinkActive="active" 
         class="nav-link-mobile" (click)="closeMenu()">
        Blog
      </a>
      @if (isLoggedIn) {
        <a routerLink="/dashboard" routerLinkActive="active" 
           class="nav-link-mobile" (click)="closeMenu()">
          Dashboard
        </a>
        <button (click)="logout()" class="nav-link-mobile logout-btn-mobile">
          Logout
        </button>
      } @else {
        <a routerLink="/auth/login" routerLinkActive="active" 
           class="nav-link-mobile" (click)="closeMenu()">
          Login
        </a>
        <a routerLink="/auth/register" routerLinkActive="active" 
           class="nav-link-mobile" (click)="closeMenu()">
          Get Started
        </a>
      }
    </nav>
  }
</header>
